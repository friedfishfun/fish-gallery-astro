---
import { getBlogList, getCategoryList } from "@libs/microcms.ts";
import Layout from "@layouts/Layout.astro";
import BlogList from "@components/BlogList.astro";
import Pagination from "@components/Pagination.astro";
import CategoryList from "@components/CategoryList.astro";
import { LIMIT } from "@constants/index.ts";
import { getSettings } from "@libs/microcms.ts";
export const prerender = true;

const settings = await getSettings();

const { contents: blogs, totalCount } = await getBlogList({
  limit: LIMIT,
});

// ã‚¿ã‚¤ãƒ—åˆ¥ã«åˆ†ã‘ã‚‹
// ã‚¿ã‚¤ãƒ—å€¤ã®æºã‚Œå¯¾ç­–ï¼ˆnull/ç©ºç™½ã‚’å¸åï¼‰
const typeOf = (blog) => (blog.content_type ?? "").trim();

// ã‚¿ã‚¤ãƒ—åˆ¥ã«åˆ†ã‘ã‚‹
const culturePost = blogs.find((blog) => typeOf(blog) === "culture");
const sakanakaraPosts = blogs.filter((blog) => typeOf(blog) === "sakanakara");

// ğŸ‘‡ culturePost ãŒã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«æ··ã–ã‚‰ãªã„ã‚ˆã† â€œIDã§ç¢ºå®Ÿã«é™¤å¤–â€
const otherPosts = blogs.filter((blog) => {
  const t = typeOf(blog);

  // æ–‡åŒ–å®£è¨€ï¼ˆè¦‹ã¤ã‹ã£ã¦ã„ã‚Œã°ï¼‰ã‚’é™¤å¤–
  if (culturePost && blog.id === culturePost.id) return false;

  // ã‚µã‚«ãƒŠã‚«ãƒ©ã‚’é™¤å¤–
  if (t === "sakanakara") return false;

  // ãã‚Œä»¥å¤–ã‚’ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã¸
  return true;
});

const { contents: categories } = await getCategoryList();

const Meta = {
  title: settings?.title || "Set Your Title Here",
};
---

<Layout Meta={Meta}>
  <div class="space-y-16">

    {/* ä¸Šæ®µï¼šæ–‡åŒ–å®£è¨€ */}
    {culturePost && (
      <section>
        <h2 class="text-3xl font-bold mb-4">é­šæšã’æ–‡åŒ–å®£è¨€</h2>
        <a href={`/blog/${culturePost.id}`} class="block border p-6 rounded-lg hover:bg-gray-50 transition">
          <h3 class="text-2xl font-semibold mb-2">{culturePost.title}</h3>
          <p class="text-gray-600">ç¶šãã‚’èª­ã‚€ â†’</p>
        </a>
      </section>
    )}

    {/* ä¸­æ®µï¼šã‚µã‚«ãƒŠã‚«ãƒ© */}
    {sakanakaraPosts.length > 0 && (
      <section>
        <h2 class="text-3xl font-bold mb-4">ã‚µã‚«ãƒŠã‚«ãƒ©</h2>
        <BlogList blogs={sakanakaraPosts} />
      </section>
    )}

    {/* ä¸‹æ®µï¼šãã®ä»– */}
    {otherPosts.length > 0 && (
      <section>
        <h2 class="text-3xl font-bold mb-4">ã‚®ãƒ£ãƒ©ãƒªãƒ¼</h2>
        <BlogList blogs={otherPosts} />
      </section>
    )}

  </div>

  <div class="space-y-8 mt-16">
    <CategoryList categories={categories} />
  </div>
</Layout>
